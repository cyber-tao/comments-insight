# 实现计划

- [x] 1. 项目初始化和基础架构搭建
  - 使用Vite + CRXJS创建Chrome扩展项目结构
  - 配置TypeScript、Tailwind CSS和构建工具
  - 创建manifest.json文件，配置Manifest V3所需的权限和声明
  - 设置开发和生产环境的构建脚本
  - _需求: 12.1, 12.2, 12.3_

- [x] 2. Service Worker核心模块实现
  - [x] 2.1 实现TaskManager任务管理器
    - 编写Task接口和TaskManager类
    - 实现任务创建、启动、更新、完成和取消功能
    - 实现任务队列管理和状态追踪
    - _需求: 8.1, 8.2, 8.3_
  
  - [x] 2.2 实现StorageManager存储管理器
    - 编写Settings和HistoryItem接口
    - 实现基于chrome.storage.local的设置读写功能
    - 实现历史记录的CRUD操作
    - 实现设置的导入导出功能
    - _需求: 7.6, 7.7, 9.1, 9.2_
  
  - [x] 2.3 实现AIService AI服务模块
    - 编写AIConfig、AIRequest和AIResponse接口
    - 实现通用的AI API调用函数
    - 实现获取可用模型列表的功能
    - 实现评论数据分批处理和结果合并逻辑
    - _需求: 3.4, 7.2, 7.3, 7.4_
  
  - [x] 2.4 实现MessageRouter消息路由器
    - 编写消息类型定义和Message接口
    - 实现chrome.runtime.onMessage监听器
    - 实现各类消息的路由和处理逻辑
    - _需求: 8.1_

- [x] 3. Content Scripts基础实现
  - [x] 3.1 实现PlatformDetector平台检测器
    - 编写Platform类型定义
    - 实现基于URL和DOM特征的平台识别逻辑
    - 实现获取帖子URL和标题的功能
    - 支持YouTube、Bilibili、微博、抖音、Twitter、TikTok、Reddit
    - _需求: 1.1, 1.6_
  
  - [x] 3.2 实现DOMAnalyzer DOM分析器
    - 编写DOMNode接口
    - 实现分层DOM结构分析功能
    - 实现DOM节点序列化为AI可理解格式的功能
    - 实现按选择器获取内容的辅助函数
    - _需求: 2.1, 2.2_
  
  - [x] 3.3 实现PageController页面控制器
    - 实现自动滚动加载更多评论的功能
    - 实现展开折叠回复的功能
    - 实现点击"加载更多"按钮的功能
    - 实现等待元素出现的辅助函数
    - _需求: 1.4, 1.5_
  
  - [x] 3.4 实现CommentExtractor基础框架
    - 编写Comment接口
    - 集成DOMAnalyzer和PageController
    - 实现基础评论提取框架
    - 实现CommentExtractorSelector（选择器方法）
    - 实现CommentExtractorProgressive（渐进式方法）
    - _需求: 1.1, 1.2, 1.3_

- [x] 4. AI提示词模板实现
  - [x] 4.1 实现评论提取提示词模板
    - 编写评论提取的系统提示词
    - 实现DOM内容格式化为提示词的功能
    - 确保AI返回严格的JSON格式
    - _需求: 2.3, 2.5_
  
  - [x] 4.2 实现评论分析提示词模板
    - 编写评论分析的系统提示词
    - 实现用户自定义提示词模板功能
    - 实现提示词占位符替换逻辑
    - 确保AI返回Markdown格式的分析报告
    - _需求: 3.1, 3.2, 3.3, 3.5, 3.6, 7.6_

- [x] 5. UI组件 - Popup弹出窗口
  - [x] 5.1 创建Popup基础结构
    - 使用React创建Popup组件
    - 实现平台信息显示
    - 实现"开始提取"和"开始分析"按钮
    - 实现任务状态显示和进度追踪
    - _需求: 1.1, 11.1, 11.2_
  
  - [x] 5.2 实现任务状态显示
    - 实现任务进度条和状态指示器
    - 实现任务取消功能
    - 实现页面状态检查（已提取/已分析）
    - _需求: 8.2, 8.3, 8.6_

- [x] 6. UI组件 - Options设置页面
  - [x] 6.1 创建Options页面完整结构
    - 使用React创建Options页面
    - 实现基本设置、AI模型配置、导入导出界面
    - 实现最大评论数设置和语言选择器
    - 实现API URL和API Key输入框（带脱敏显示）
    - 实现模型参数配置（maxTokens、temperature、topP）
    - 实现分析提示词模板编辑器
    - 实现导入导出功能
    - 实现获取模型列表功能
    - 实现模型测试功能
    - 实现自动保存功能
    - _需求: 7.1, 7.2, 7.3, 7.4, 7.5, 7.6, 7.7, 7.8_

- [x] 7. Content Script与Background完整集成
  - [x] 7.1 实现AI驱动的评论提取
    - 在CommentExtractor中集成AIService
    - 实现使用AI识别评论结构的功能
    - 实现基于AI识别结果的评论提取
    - 实现评论数据的验证和清洗
    - _需求: 2.3, 2.4, 2.5_
  
  - [x] 7.2 实现Content Script与Background通信
    - 实现START_EXTRACTION消息的完整处理流程
    - 在Content Script中接收提取任务并执行
    - 实现提取进度的实时更新
    - 实现提取完成后的数据传递和历史记录保存
    - _需求: 8.1, 8.2_

- [x] 8. History历史记录页面实现
  - [x] 8.1 创建History页面完整结构
    - 实现左右分栏布局（列表和详情）
    - 创建HistoryList组件显示历史记录列表
    - 显示帖子标题、平台、时间等信息
    - _需求: 9.1, 11.1, 11.2_
  
  - [x] 8.2 实现历史记录交互功能
    - 实现搜索和筛选功能
    - 实现删除历史记录功能
    - 实现清空所有历史记录功能
    - 实现点击查看详情功能
    - _需求: 9.2, 9.5, 9.6_
  
  - [x] 8.3 实现历史记录详情展示
    - 创建HistoryDetail组件
    - 显示帖子链接和基本信息
    - 实现评论视图和分析视图切换
    - 集成CommentsView和AnalysisView组件
    - _需求: 9.3, 9.4_

- [x] 9. 评论查看和分析展示组件
  - [x] 9.1 实现CommentsView评论查看组件
    - 创建CommentsView组件
    - 创建CommentTree递归组件显示评论树
    - 创建CommentNode组件显示单条评论
    - 实现评论展开/折叠功能
    - _需求: 4.1, 4.2, 4.3, 4.4, 4.5_
  
  - [x] 9.2 实现AnalysisView分析结果展示组件
    - 创建AnalysisView组件
    - 使用react-markdown实现Markdown渲染功能
    - 支持GFM（GitHub Flavored Markdown）
    - _需求: 6.1, 6.2, 6.3_

- [x] 10. 数据导出功能实现
  - [x] 10.1 实现CSV导出功能
    - 编写评论数据转CSV格式的函数
    - 实现包含所有字段的CSV导出
    - 实现文件下载功能
    - 在History页面添加导出按钮
    - _需求: 5.1, 5.3, 5.5_
  
  - [x] 10.2 实现Markdown导出功能
    - 编写分析结果转Markdown文件的函数
    - 实现完整分析报告的Markdown导出
    - 实现文件下载功能
    - 在History页面添加导出按钮
    - _需求: 5.2, 5.4, 5.5_
  
  - [x] 10.3 实现JSON导出功能
    - 实现完整数据（评论+分析）的JSON导出
    - 在History页面添加导出按钮
    - _需求: 5.5_

- [x] 11. 国际化实现
  - [x] 11.1 配置i18next国际化框架
    - 配置i18next和react-i18next
    - 创建locales/zh-CN.json和locales/en-US.json语言文件
    - 实现语言文件的加载和切换
    - _需求: 10.1, 10.2_
  
  - [x] 11.2 实现所有UI文本的国际化
    - 替换Popup中的硬编码文本为i18n key
    - 替换Options中的硬编码文本为i18n key
    - 替换History中的硬编码文本为i18n key
    - 实现根据浏览器语言自动选择界面语言
    - 实现手动切换语言功能
    - _需求: 10.2, 10.3, 10.4_

- [x] 12. 通知系统实现
  - [x] 12.1 实现NotificationService
    - 使用chrome.notifications API实现浏览器通知
    - 在任务完成时显示通知
    - 在任务失败时显示通知
    - _需求: 8.5_

- [x] 13. 评论排序功能




  - [x] 13.1 实现评论排序选择器


    - 在CommentsView中添加排序选择器
    - 实现按时间排序
    - 实现按点赞数排序
    - 实现按回复数排序
    - _需求: 4.2_


- [x] 14. 错误处理和日志系统优化




  - [x] 14.1 实现统一错误处理系统


    - 编写ExtensionError类和ErrorCode枚举
    - 实现ErrorHandler错误处理器
    - 实现重试机制和降级处理
    - 在所有关键操作中添加错误处理
    - 实现用户友好的错误提示
    - _需求: 11.4_
  
  - [x] 14.2 实现结构化日志系统


    - 编写Logger类
    - 实现开发模式和发布模式的日志级别控制
    - 替换所有console.log为Logger调用
    - 实现日志查看界面（已有logs页面基础）
    - _需求: 12.2, 12.4_

- [ ] 15. 性能优化
  - [ ] 15.1 实现评论提取性能优化
    - 优化选择器重试机制
    - 实现智能滚动策略（根据页面加载速度调整）
    - 优化DOM分析的深度和广度
    - _需求: 1.4, 1.5_
  
  - [ ] 15.2 实现存储性能优化
    - 验证LZ-string数据压缩功能（已实现）
    - 实现历史记录分页加载
    - 实现历史记录自动清理（保留最近N条）
    - _需求: 9.1, 9.2_
  
  - [ ] 15.3 实现UI性能优化
    - 对大量评论列表实现虚拟滚动（使用react-window）
    - 实现图片懒加载
    - 对搜索和筛选实现防抖处理
    - _需求: 4.1, 11.3_

- [ ] 16. 数据验证和安全性增强
  - [ ] 16.1 实现AI响应数据验证
    - 对AI返回的JSON数据进行严格验证
    - 实现JSON schema验证
    - 实现数据清洗和sanitize处理
    - _需求: 2.5, 11.4_
  
  - [ ] 16.2 实现用户输入验证
    - 对用户输入进行sanitize处理
    - 验证API URL格式
    - 验证数字输入范围
    - _需求: 11.4_

- [ ] 17. GitHub Actions自动发布配置
  - [ ] 17.1 创建GitHub Actions工作流
    - 编写.github/workflows/release.yml文件
    - 配置在创建版本tag时触发构建
    - 实现自动构建和打包扩展
    - _需求: 12.5_
  
  - [ ] 17.2 配置Chrome Web Store发布
    - 配置Chrome Web Store API凭证
    - 实现自动上传到Chrome Web Store
    - 实现GitHub Release创建
    - _需求: 12.5_

- [ ] 18. 文档完善
  - [ ] 18.1 完善README.md
    - 添加详细的功能说明和截图
    - 添加安装和使用指南
    - 添加开发指南和贡献说明
    - 添加常见问题解答
    - _需求: 11.1_
  
  - [ ] 18.2 完善CHANGELOG.md
    - 记录所有版本变更历史
    - 使用语义化版本号
    - 记录Breaking Changes
    - _需求: 12.5_
  
  - [ ]* 18.3 创建使用示例和截图
    - 录制功能演示视频
    - 制作功能截图
    - 创建使用教程文档
    - _需求: 11.1_

- [ ] 19. 集成测试和调试
  - [ ] 19.1 在实际平台上测试评论提取
    - 在YouTube上测试评论提取功能
    - 在Bilibili上测试评论提取功能
    - 在Twitter/X上测试评论提取功能
    - 在Reddit上测试评论提取功能
    - 验证评论数据的完整性和准确性
    - _需求: 1.1, 1.2, 1.3, 1.6_
  
  - [ ] 19.2 测试AI分析功能
    - 使用真实评论数据测试分析功能
    - 验证Markdown格式输出的正确性
    - 测试大量评论的分批处理
    - 验证情感分析和热点评论识别准确性
    - 测试中英文分析结果
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.6_
  
  - [ ] 19.3 测试完整用户流程
    - 测试从提取到分析的完整流程
    - 测试设置的保存和加载
    - 测试历史记录的保存和查看
    - 测试数据导出功能（CSV、Markdown、JSON）
    - 测试错误处理和恢复
    - 测试语言切换功能
    - _需求: 5.1, 5.2, 7.7, 7.8, 9.1, 9.2_
  
  - [ ]* 19.4 性能和压力测试
    - 测试大量评论（1000+）的提取性能
    - 测试长时间运行的稳定性
    - 测试内存使用情况
    - 测试并发任务处理
    - _需求: 8.1, 8.2_

- [ ] 20. 高级功能增强（可选）
  - [ ]* 20.1 实现评论过滤功能
    - 按关键词过滤评论
    - 按情感过滤评论
    - 按点赞数过滤评论
    - _需求: 4.1_
  
  - [ ]* 20.2 实现评论搜索功能
    - 在评论列表中搜索关键词
    - 高亮显示搜索结果
    - _需求: 4.1_
  
  - [ ]* 20.3 实现批量操作
    - 批量删除历史记录
    - 批量导出数据
    - _需求: 9.2_
